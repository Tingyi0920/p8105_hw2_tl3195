---
title: "p8105_hw2_tl3195"
author: "Tingyi Li"
date: "2023-10-04"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

load libraries

```{r}
library(tidyverse)
library(readxl)
```

# Problem 1

Clean the data in `pols-month.csv`:

Use `separate()` to break up the variable `mon` into integer variables `year`, `month`, and `day`.
Replace month number with month name.
Create a `president` variable taking values `gop` and `dem`, and remove `prez_dem` and `prez_gop`; and remove the day variable.

```{r}
pols_month = read.csv("./fivethirtyeight_datasets/pols-month.csv") |>
  janitor::clean_names()|>
  separate(mon,into=c("year","month","day"))|>
  mutate(month = month.name[as.numeric(month)],
         president=
           case_match(prez_gop, 0~"democratic", 1~"republican", 2~"republican")
        )|>
  select(-prez_dem,-prez_gop,-day)

```

Clean snp.csv with a similar process:

arrange according to year and month, and organize so that `year` and `month` are the leading columns.

```{r}
snp = read_csv("./fivethirtyeight_datasets/snp.csv",
    col_types = cols(date = col_date(format = "%m/%d/%y"))) |>
  separate(date, into = c("year", "month", "day"), convert = TRUE) |>
  mutate(month = month.name[as.numeric(month)],
         year = if_else(year > 2023, year - 100, year)) |> 
  select(year, month, close) 

```

Tidy the unemployment data so that it can be merged with the previous datasets.

Switching from “wide” to “long” format.
Ensuring that key variables have the same name.
Ensuring that key variables have the same values.

```{r}
unemployment = read_csv("./fivethirtyeight_datasets/unemployment.csv") |>
  rename(year = Year) |>
  pivot_longer(
    Jan:Dec, 
    names_to = "month",
    values_to = "unemployment"
  ) |> 
  mutate(month=month.name[match(month,month.abb)])|>
  mutate(year=as.character(year))

```

Join the datasets by merging `snp` into `pols`, and merging `unemployment` into the result.

```{r}
pols_month$year <- as.numeric(pols_month$year)
snp$year <- as.numeric(snp$year)
unemployment$year <- as.numeric(unemployment$year)

data=pols_month |>
  left_join(snp, by=c("year", "month")) |>
  left_join(unemployment, by=c("year", "month"))

str(data)
```

Description
There exists some "NA" in both "close" and "unemployment" columns, which indicates that it's the missing value. 
The `pols-month` data has `r nrow(pols_month)` observations and `r ncol(pols_month)` variables and the variables are `year`, `month`, `gov_gop`, `sen_gop`, `rep_gop`, `gov_dem`, `sen_dem`, `rep_dem`, `president`. It tells us about whether governers belongs to democratic or republican. Moreover, we also know that the variable `year` ranges from 1947 to 2015. 
The `snp` data has `r nrow(snp)` observations and `r ncol(snp)` variables and the variables are `year`, `month`, and `close`. The varibale `year` ranges from 1950 to 2015.
The `unemployment` data has `r nrow(unemployment)` observations and `r ncol(unemployment)` variables ranging from years 1948 to 2015.
The merged dataset `data` has `r nrow(data)` observations and `r ncol(data)` variables and the variables are `year`, `month`, `gov_gop`, `sen_gop`, `rep_gop`, `gov_dem`, `sen_dem`, `rep_dem`, `president`, `close`, and `unemployment`. The variable `year` ranges from 1947 to 2015.

# Problem 2

Read and clean the Mr. Trash Wheel sheet:

Specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in `read_excel`
Use reasonable variable names
Omit rows that do not include dumpster-specific data
Update the data to include a new `homes_powered` variable based on this calculation: Homes Powered - Each ton of trash equates to on average 500 kilowatts of electricity. An average household will use 30 kilowatts per day.

```{r}
mr_trash_wheel = read_excel(
  "202309 Trash Wheel Collection Data.xlsx", 
  sheet="Mr. Trash Wheel", range = cell_cols("A:N"))|>
  janitor::clean_names()|>
  filter(row_number() <= n()-1)|>
  mutate(homes_powered=weight_tons*500/30)

mr_trash_wheel
```

Professor Trash Wheel with a similar process

```{r}
professor_trash_wheel = read_excel(
  "202309 Trash Wheel Collection Data.xlsx", 
  sheet="Professor Trash Wheel", range = cell_cols("A:N"))|>
  janitor::clean_names()|>
  filter(row_number() <= n()-1)|>
  mutate(homes_powered=weight_tons*500/30)

professor_trash_wheel
```

Gwynnda with a similar process

```{r}
gwynnda_trash_wheel = read_excel(
  "202309 Trash Wheel Collection Data.xlsx", 
  sheet="Gwynnda Trash Wheel", range = cell_cols("A:N"))|>
  janitor::clean_names()|>
  filter(row_number() <= n()-2)|>
  mutate(homes_powered=weight_tons*500/30)

gwynnda_trash_wheel
```

Combine these with the Mr. Trash Wheel dataset to produce a single tidy dataset. To keep track of which Trash Wheel is which, I add an additional variable called `trashwheel` to all datasets before combining.

```{r}
mr_trash_wheel=mr_trash_wheel |>
  mutate(trashwheel="Mr. Trash Wheel",
         year=as.numeric(year))

professor_trash_wheel=professor_trash_wheel |>
  mutate(trashwheel="Professor Trash Wheel")

gwynnda_trash_wheel=gwynnda_trash_wheel |>
  mutate(trashwheel="Gwynnda Trash Wheel")

mr_trash_wheel_tidy = 
  bind_rows(mr_trash_wheel, professor_trash_wheel, gwynnda_trash_wheel) |>
  janitor::clean_names() |>
  select(trashwheel, everything())

mr_trash_wheel_tidy
```

